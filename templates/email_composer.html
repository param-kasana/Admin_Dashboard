{% extends "layout.html" %}
{% block title %}Email Composer{% endblock %}
{% block content %}

<div class="email-composer-main-layout">
    <div class="composer-left-panel">
        <div class="composer-form-section">
            <h2>Compose Email</h2>
        <form id="emailComposeForm" method="POST" action="/send-composed-email" enctype="multipart/form-data">
            <label for="quiz_type">Select Quiz</label>
            <select id="quiz_type" name="quiz" required>
            <option value="">— choose quiz —</option>
            </select>

            <label for="personality_type">Select Personality</label>
            <select id="personality_type" name="personality" required>
            <option value="">— choose personality —</option>
            </select>

            <label>
            <input type="checkbox" id="edit_recipients_toggle">
            Edit recipients manually
            <span id="recipient_count_display" style="margin-left: 8px; font-weight: normal; color: #555;"></span>
            </label>
            <div id="recipients_container" class="recipient-list">
            <em>Pick quiz & personality to load recipients…</em>
            </div>

            <label for="emailSubject">Subject</label>
            <input type="text" id="emailSubject" name="subject" required placeholder="Enter email subject">

            <div style="display: flex; gap: 12px; align-items: flex-end; margin-bottom: 8px;">
              <div style="flex: 1;">
                <label for="emailSalutation">Salutation</label>
                <input type="text" id="emailSalutation" name="salutation" placeholder="e.g., Dear" style="width: 100%;">
              </div>
              <div style="flex: 1;">
                <label>Name</label>
                <input type="text" value="Name" readonly style="width: 100%; background: #f5f5f5;">
              </div>
            </div>

            <label for="emailOpening">Opening Lines</label>
            <textarea id="emailOpening" name="opening_lines" rows="2" placeholder="e.g., Dear {name}, Thank you for..." required></textarea>

            <label for="emailClosing">Closing Lines</label>
            <textarea id="emailClosing" name="closing_lines" rows="2" placeholder="e.g., Warm regards, The Team" required></textarea>
            
            <label for="attachment">Attach Document (Optional)</label>
            <input type="file" id="attachment" name="attachment">

            <button type="submit" class="button-primary">Send Email</button>
        </form>
        </div>
    </div>

    <div class="composer-right-panel">
        <div class="email-preview-section">
            <h2>Live Email Preview</h2>
            <div id="emailPreviewBody" class="email-preview-body"></div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='tinymce/js/tinymce/tinymce.min.js') }}"></script>
<script src="{{ url_for('static', filename='email_composer/email_composer.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='email_composer/email_composer.css') }}">

{% endblock %}
